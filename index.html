<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°˜ì‘í˜• í•˜ì´ë¸Œë¦¬ë“œ ì—ë””í„°</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/htmlmixed/htmlmixed.min.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden; /* ì „ì²´ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            font-family: 'Roboto Mono', monospace;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100%;
        }

        /* ì™¼ìª½ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .left-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
            background-color: #282a36;
            min-width: 0; /* Flexbox ë‚´ë¶€ ì˜¤ë²„í”Œë¡œìš° ë°©ì§€ */
        }

        /* íˆ´ë°” ìŠ¤íƒ€ì¼ */
        .toolbar {
            padding: 0 10px;
            background-color: #1e1e1e;
            display: flex;
            gap: 8px;
            border-bottom: 1px solid #444;
            height: 50px;
            flex-shrink: 0; /* ë†’ì´ ì¤„ì–´ë“¤ì§€ ì•ŠìŒ */
            align-items: center;
        }

        button {
            padding: 6px 10px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            font-weight: bold;
            color: white;
            transition: opacity 0.2s;
        }
        button:hover { opacity: 0.8; }

        .btn-reset { background-color: #ff5555; }
        .btn-save { background-color: #50fa7b; color: #282a36; }
        .btn-toggle { background-color: #8be9fd; color: #282a36; }

        /* ê¸°ë³¸ Textarea ìŠ¤íƒ€ì¼ (CodeMirror êº¼ì¡Œì„ ë•Œ) */
        #code-area {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            background-color: #282a36;
            color: #f8f8f2;
            border: none;
            padding: 10px;
            resize: none;
            outline: none;
            font-family: 'Roboto Mono', monospace;
            font-size: 15px;
            box-sizing: border-box;
            display: block; /* ê¸°ë³¸ì ìœ¼ë¡œ í‘œì‹œ */
        }

        /* CodeMirror ìŠ¤íƒ€ì¼ ë®ì–´ì“°ê¸° */
        .CodeMirror {
            flex-grow: 1;
            height: 100% !important; 
            font-family: 'Roboto Mono', monospace;
            font-size: 15px;
        }

        /* ë¦¬ì‚¬ì´ì € (PCìš©) */
        .resizer {
            width: 6px;
            background-color: #44475a;
            cursor: col-resize;
            z-index: 10;
            flex-shrink: 0;
        }

        .right-panel {
            flex-grow: 1;
            background-color: white;
            position: relative;
            min-width: 0;
        }

        iframe { width: 100%; height: 100%; border: none; }
        .pointer-events-none { pointer-events: none; }

        /* ğŸ“± ëª¨ë°”ì¼ ëŒ€ì‘ (í™”ë©´ í­ 768px ì´í•˜) */
        @media (max-width: 768px) {
            .container {
                flex-direction: column; /* ì„¸ë¡œ ë°°ì¹˜ë¡œ ë³€ê²½ */
            }

            .left-panel {
                width: 100% !important; /* ê°•ì œ 100% */
                height: 50%;
            }

            .right-panel {
                width: 100% !important;
                height: 50%;
            }

            /* ëª¨ë°”ì¼ì—ì„œëŠ” ë³µì¡ì„±ì„ í”¼í•˜ê¸° ìœ„í•´ ë¦¬ì‚¬ì´ì € ìˆ¨ê¹€ */
            .resizer {
                display: none; 
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="left-panel" id="leftPanel">
            <div class="toolbar">
                <button class="btn-reset" onclick="resetCode()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                <button class="btn-save" onclick="saveCode()">ğŸ’¾ ì €ì¥</button>
                <button class="btn-toggle" onclick="toggleEditorMode()">ğŸ”„ ëª¨ë“œ ì „í™˜</button>
                <span id="mode-label" style="color:#aaa; font-size: 11px; margin-left: auto;">CodeMirror</span>
            </div>
            
            <textarea id="code-area" placeholder="ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        </div>

        <div class="resizer" id="resizer"></div>

        <div class="right-panel" id="rightPanel">
            <iframe id="preview"></iframe>
        </div>
    </div>

    <script>
        const textarea = document.getElementById('code-area');
        const preview = document.getElementById('preview');
        const modeLabel = document.getElementById('mode-label');
        
        // ê¸°ë³¸ ì½”ë“œ
        const defaultCode = `<!DOCTYPE html>
<html>
<head>
<style>
  body { font-family: sans-serif; padding: 20px; text-align: center;}
  h1 { color: #ff79c6; }
  button { padding: 10px 20px; background: #8be9fd; border: none; cursor: pointer; }
</style>
</head>
<body>
  <h1>Hello Mobile!</h1>
  <p>í™”ë©´ì„ ì¤„ì—¬ë³´ì„¸ìš”. ë°°ì¹˜ê°€ ë°”ë€ë‹ˆë‹¤.</p>
  <button>í´ë¦­!</button>
</body>
</html>`;

        // ìƒíƒœ ë³€ìˆ˜
        let cmEditor = null; // CodeMirror ì¸ìŠ¤í„´ìŠ¤ ì €ì¥ìš©

        // --- 1. ì´ˆê¸°í™” ë° Local Storage ë¡œë“œ ---
        const savedCode = localStorage.getItem('myHtmlCode') || defaultCode;
        textarea.value = savedCode;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ CodeMirror í™œì„±í™”
        enableCodeMirror();
        updatePreview(savedCode);


        // --- 2. ì—ë””í„° ëª¨ë“œ ì „í™˜ ê¸°ëŠ¥ (í•µì‹¬) ---
        function toggleEditorMode() {
            if (cmEditor) {
                // CodeMirror -> Textarea (ì¼ë°˜ ëª¨ë“œë¡œ)
                // 1. í˜„ì¬ CMì˜ ë‚´ìš©ì„ ê°€ì ¸ì™€ì„œ Textareaì— ë™ê¸°í™”
                textarea.value = cmEditor.getValue();
                // 2. CM ì¸ìŠ¤í„´ìŠ¤ íŒŒê´´ (ë‹¤ì‹œ textareaê°€ ë³´ì„)
                cmEditor.toTextArea(); 
                cmEditor = null;
                
                // 3. Textareaì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° (ìˆ˜ë™ ì…ë ¥ ê°ì§€)
                textarea.addEventListener('input', handleTextareaInput);
                
                modeLabel.innerText = "Textarea";
            } else {
                // Textarea -> CodeMirror (ê³ ê¸‰ ëª¨ë“œë¡œ)
                // 1. Textarea ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
                textarea.removeEventListener('input', handleTextareaInput);
                
                // 2. CodeMirror í™œì„±í™”
                enableCodeMirror();
                
                modeLabel.innerText = "CodeMirror";
            }
        }

        // --- 3. CodeMirror í™œì„±í™” í•¨ìˆ˜ ---
        function enableCodeMirror() {
            cmEditor = CodeMirror.fromTextArea(textarea, {
                mode: "htmlmixed",
                theme: "dracula",
                lineNumbers: true,
                lineWrapping: true,
            });

            // CM ë‚´ìš© ë³€ê²½ ì‹œ ì‹¤í–‰í•  í•¨ìˆ˜ ì—°ê²°
            cmEditor.on('change', () => {
                const currentCode = cmEditor.getValue();
                // ì›ë³¸ textareaì—ë„ ê°’ì„ ë„£ì–´ì¤˜ì•¼ ë‚˜ì¤‘ì— ëª¨ë“œ ì „í™˜ ì‹œ ë°ì´í„°ê°€ ìœ ì§€ë¨
                textarea.value = currentCode; 
                saveAndPreview(currentCode);
            });
        }

        // --- 4. ì¼ë°˜ Textarea ì…ë ¥ í•¸ë“¤ëŸ¬ ---
        function handleTextareaInput() {
            saveAndPreview(textarea.value);
        }

        // --- 5. ê³µí†µ ì €ì¥ ë° ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜ ---
        function saveAndPreview(code) {
            preview.srcdoc = code;
            localStorage.setItem('myHtmlCode', code);
        }
        
        // ì´ˆê¸° ë¡œë“œ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì‹¤í–‰
        function updatePreview(code) {
            preview.srcdoc = code;
        }

        // --- 6. ë²„íŠ¼ ê¸°ëŠ¥ë“¤ ---
        function resetCode() {
            if(confirm("ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                const code = defaultCode;
                if (cmEditor) {
                    cmEditor.setValue(code);
                } else {
                    textarea.value = code;
                    saveAndPreview(code);
                }
            }
        }

        function saveCode() {
            // í˜„ì¬ í™œì„±í™”ëœ ëª¨ë“œì— ë”°ë¼ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
            const code = cmEditor ? cmEditor.getValue() : textarea.value;
            const blob = new Blob([code], { type: "text/html" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "index.html";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- 7. ë¦¬ì‚¬ì´ì¦ˆ (PC ì „ìš©) ---
        const resizer = document.getElementById('resizer');
        const leftPanel = document.getElementById('leftPanel');
        const container = document.querySelector('.container');
        let isResizing = false;

        resizer.addEventListener('mousedown', () => {
            isResizing = true;
            preview.classList.add('pointer-events-none');
            document.body.style.cursor = 'col-resize';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            // í™”ë©´ ë„ˆë¹„ê°€ 768pxë³´ë‹¤ í´ ë•Œë§Œ ì‘ë™ (ëª¨ë°”ì¼ ì˜¤ì‘ë™ ë°©ì§€)
            if (window.innerWidth > 768) {
                const newPercent = (e.clientX / container.offsetWidth) * 100;
                if (newPercent > 10 && newPercent < 90) leftPanel.style.width = newPercent + '%';
            }
        });

        document.addEventListener('mouseup', () => {
            isResizing = false;
            preview.classList.remove('pointer-events-none');
            document.body.style.cursor = 'default';
        });

    </script>
</body>
</html>
